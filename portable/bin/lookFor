#!/bin/bash
curdir=`pwd`
ROOT="$curdir"
while [ "`pwd`" != '/' ]; do
    if [ -f ".lookHere" ]; then
        if [ -s ".lookHere" ]; then
            ROOT=`cat .lookHere`
        else
            ROOT=`pwd`
        fi
        break
    fi
    cd ..
done
cd $curdir
find "$ROOT" \
    \( \
    -not -iname '*.bak' \
    -not -iname '*.tmp' \
    -not -iname "*.csv" \
    ! -iname "*.data" \
    ! -iname "*.reg" \
    ! -iname "*.log" \
    ! -iname "*.log.?" \
    ! -iname "*.xmf" \
    ! -iname "*.xsf" \
    ! -iname "*.pickle" \
    ! -iname "*.h" \
    ! -iname "*.crt" \
    ! -iname "*.decTest" \
    ! -iname ".filemap" \
    ! -iname "*.xaf" \
    ! -iname "*.svg" \
    ! -iname "*.as" \
    ! -iname "*.rc" \
    ! -iname "*.frq" \
    ! -iname "tzmappings" \
    ! -iname "*~" \
    ! -iname "#*#" \
    ! -iname "*.fail.html" \
    ! -iname "*.pyc" \
    ! -iname "*.min.js" \
    -name "*$@*" \
    \) \
    | grep -v '.git' \
    | grep -v 'coverage/Phantom' \
    | grep -v 'coverage/coverage-Phantom' \
    | grep -v '^cover/' \
    | grep -v 'mobileapp/nve' \
    | sed s=^$curdir/==
ag -r -Q \
    --ignore="*.bak" \
    --ignore="*.tmp" \
    --ignore="*.csv" \
    --ignore="*.data" \
    --ignore="*.reg" \
    --ignore="*.log" \
    --ignore="*.log.?" \
    --ignore="*.xmf" \
    --ignore="*.xsf" \
    --ignore="*.pickle" \
    --ignore="*.h" \
    --ignore="*.crt" \
    --ignore="*.decTest" \
    --ignore=".filemap" \
    --ignore="*.xaf" \
    --ignore="*.svg" \
    --ignore="*.as" \
    --ignore="*.rc" \
    --ignore="*.frq" \
    --ignore="tzmappings" \
    --ignore="*~" \
    --ignore="#*#" \
    --ignore="*.fail.html" \
    --ignore="*.pyc" \
    --ignore="*.min.js" \
    --ignore="*benchmark.html" \
    --ignore="rcover_*" \
    --ignore="nosetests.xml" \
    --ignore-dir=".git" \
    --ignore-dir=".svn" \
    --ignore-dir="libphutil" \
    "$@" \
    "$ROOT" \
    | sed s=^`pwd`/==
